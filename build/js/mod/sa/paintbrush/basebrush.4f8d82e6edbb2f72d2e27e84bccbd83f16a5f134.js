/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){var a=$.Listener=require("mod/se/listener.263f38898829bcbd37b39b7743be119a9db33581"),b=window.StyleTypes={LINEAR:"linear",RADIAL:"radial",COLOR:"color",PATTERN:"pattern"},c=function(b){this.stage=b,this.context=b.getContext("2d"),this.isDrawing=!1,this.currentPoint=null,this.lastPoint=null,this.lineWidth=1,this.lineJoin="round",this.lineCap="round",this.miterLimit=3,this.shadowBlur=1,this.shadowColor="#000",this.shadowOffsetX=0,this.shadowOffsetY=0,this.points=[],this.colors=[],this.stageOffsetX=0,this.stageOffsetY=0,this.listener=new a({onstart:null,ondrawing:null,onend:null})};c.prototype={exec:function(a,b){return this.listener.exec(a,b)},set:function(a,b){this.listener.set(a,b)},remove:function(a){this.listener.remove(a)},get:function(a){return this.listener.get(a)},clear:function(){this.listener.clear()},setLineWidth:function(a){this.lineWidth=a},setLineJoin:function(a){this.lineJoin=a},setLineCap:function(a){this.lineCap=a},setMiterLimit:function(a){this.miterLimit=a},setShadowBlur:function(a){this.shadowBlur=a},setShadowColor:function(a){this.shadowColor=a},setShadowOffsetX:function(a){this.shadowOffsetX=a},setShadowOffsetY:function(a){this.shadowOffsetY=a},addPoint:function(a,b){this.points.push({x:a,y:b})},getPoint:function(a){return this.points[a]||{x:0,y:0}},clearPoints:function(){this.points.length=0},addColor:function(a,b){this.colors.push({stop:a,color:b})},getColor:function(a){return this.colors[a]||{stop:1,color:"transparent"}},clearColors:function(){this.colors.length=0},createLinearGradient:function(a,b,c,d){for(var e=this.context,f=e.createLinearGradient(b,b,c,d),g=null,h=0,i=this.colors.length;i>h;h++)g=this.colors[h],f.addColorStop(g.stop,g.color);return f},createRadialGradient:function(a,b,c,d,e,f){for(var g=this.context,h=g.createRadialGradient(b,b,c,d,e,f),i=null,j=0,k=this.colors.length;k>j;j++)i=this.colors[j],h.addColorStop(i.stop,i.color);return h},createPattern:function(a,b){var c=this.context,d=c.createPattern(a,b||"repeat");return d},getBrushStyle:function(a,c){var d=null,e=this.colors,f=e.length;switch(a=a||b.COLOR,1>=f&&(a=b.COLOR),a){case b.LINEAR:d=this.createLinearGradient.apply(this,c);break;case b.RADIAL:d=this.createRadialGradient.apply(this,c);break;case b.PATTERN:d=this.createPattern.apply(this,c);break;default:d=this.getColor(0).color||"transparent"}return d},clacDistanceBetween:function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},calcAngleBetween:function(a,b){return Math.atan2(b.x-a.x,b.y-a.y)},calcMiddlePointBetween:function(a,b){return{x:a.x+(b.x-a.x)/2,y:a.y+(b.y-a.y)/2}},generateRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},getPointerPosition:function(a){a.changedTouches&&(a=a.changedTouches[a.changedTouches.length-1]);var b=0,c=0,d=a.clientX,e=a.clientY,f=document.body,g=f.scrollLeft,h=f.scrollTop,i=$(this.stage),j=i.offset();return this.stageOffsetX=j.left,this.stageOffsetY=j.top,b=(d+g||a.pageX)-j.left||0,c=(e+h||a.pageY)-j.top||0,{x:b,y:c}},bind:function(){var a="ontouchstart"in window,b=a?"touchstart":"mousedown",c=a?"touchend":"mouseup",d=a?"touchmove":"mousemove",e=$(this.stage),f="1"==e.attr("data-bind");f||e.on(b,"",this,function(a){var b=a.data;b.exec("start",[a,b])}).on(c,"",this,function(a){var b=a.data;b.exec("end",[a,b])}).on(d,"",this,function(a){var b=a.data;b.exec("drawing",[a,b])})}},module.exports=c});
